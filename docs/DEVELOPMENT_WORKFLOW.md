# RegistryTools 开发流程规范

> **版本**: v1.0
> **更新日期**: 2026-01-04
> **项目**: RegistryTools - MCP Tool Registry Server

---

## 核心原则

> **每推进下一个阶段的开发任务前，必须：**
>
> 1. **明确申明开发流程** - 引用本文档，审阅具体规范要求
> 2. **制定 TODO 清单** - 基于 `docs/TASK.md` 任务追踪文档
> 3. **执行交叉验证** - 避免遗漏和技术债务累积

---

## 阶段开发规范

### 每阶段开始前

```markdown
## 正确的阶段开始流程

### 步骤 1: 明确申明规范
> 申明内容: "遵循 `docs/DEVELOPMENT_WORKFLOW.md` 规范，开始 Phase X 开发"
>
> 审阅确认:
> - 阅读 docs/DEVELOPMENT_WORKFLOW.md
> - 确认 Phase X 的具体规范要求
> - 明确输出物和验收标准

### 步骤 2: 创建 TODO 清单
基于 docs/TASK.md 创建详细的 TODO 列表:
- [ ] TASK-XXX: 具体任务1
- [ ] TASK-YYY: 具体任务2
- [ ] TASK-ZZZ: 具体任务3

### 步骤 3: 执行与验证
- 完成任务 → 交叉验证 → 标记完成
- 每个任务完成后必须进行验证确认

### 步骤 4: 阶段完成
- 更新 docs/TASK.md → git commit → 交叉验证 → 进入下一阶段
```

---

## TASK.md 同步提交规范

**TASK.md 是项目的唯一任务追踪文档，必须保持与实际开发同步：**

### 提交规范

1. **每阶段完成后必须更新 TASK.md**
   - 更新任务状态（TODO → IN_PROGRESS → DONE）
   - 记录完成时间和备注信息
   - 更新项目进度百分比

2. **TASK.md 更新必须立即 git commit**
   - 每个阶段完成后，TASK.md 的更新必须作为独立提交
   - 提交信息遵循 Conventional Commits 规范
   - 提交前必须进行交叉验证确认

3. **禁止批量延迟提交**
   - 严禁多个阶段的 TASK.md 更新合并为一次提交
   - 每个阶段的文档更新必须独立可追溯

---

## 交叉验证确认清单

每完成一个阶段任务，必须执行以下验证：

```bash
# 1. 确认 git 状态
git status

# 2. 确认提交历史
git log --oneline -5

# 3. 确认 TASK.md 更新
grep "Phase X" docs/TASK.md

# 4. 确认文档同步
ls -la docs/

# 5. 确认代码质量（如有代码变更）
# pytest tests/
# ruff check src/registrytools/
# black --check src/registrytools/
```

---

## 9 阶段开发流程

### 阶段 1: 需求分析

**目标**: 明确功能需求和技术约束

**输出物**:
- 功能需求文档
- 技术选型报告
- 验收标准

**验收标准**:
- [ ] 需求明确无歧义
- [ ] 技术方案可行
- [ ] 风险已识别

---

### 阶段 2: 方案设计

**目标**: 设计系统架构和数据流

**输出物**:
- 系统架构图
- 数据模型设计
- API 接口设计

**验收标准**:
- [ ] 架构清晰合理
- [ ] 模块职责明确
- [ ] 接口定义完整

---

### 阶段 3: 任务拆解

**目标**: 将设计拆解为可执行的任务

**输出物**:
- 任务清单（TASK.md）
- 优先级排序
- 依赖关系图

**验收标准**:
- [ ] 任务粒度适中
- [ ] 依赖关系清晰
- [ ] 估时合理

---

### 阶段 4: 代码实现

**目标**: 按照设计实现功能

**输出物**:
- 源代码
- 单元测试

**验收标准**:
- [ ] 代码符合规范
- [ ] 测试覆盖率 > 80%
- [ ] 功能正常工作

---

### 阶段 5: 测试验证

**目标**: 确保代码质量

**输出物**:
- 测试报告
- 性能基准
- 问题清单

**验收标准**:
- [ ] 所有测试通过
- [ ] 性能达标
- [ ] 无已知严重问题

---

### 阶段 6: 代码审查

**目标**: 发现潜在问题

**输出物**:
- 审查意见
- 修改清单

**验收标准**:
- [ ] 审查意见已处理
- [ ] 代码质量达标
- [ ] 文档同步更新

---

### 阶段 7: Git 提交

**目标**: 规范化代码提交

**输出物**:
- Git 提交记录
- 提交信息

**验收标准**:
- [ ] 提交信息规范
- [ ] 提交粒度合理
- [ ] TASK.md 已同步

---

### 阶段 8: 文档更新

**目标**: 保持文档同步

**输出物**:
- 更新的文档
- 变更日志

**验收标准**:
- [ ] API 文档已更新
- [ ] CHANGELOG 已记录
- [ ] 示例代码正确

---

### 阶段 9: 部署发布

**目标**: 发布新版本

**输出物**:
- 发布包
- 发布说明

**验收标准**:
- [ ] 发布验证通过
- [ ] 版本号正确
- [ ] 发布说明完整

---

## Git 工作流规范

### 分支策略

```
main (生产环境)
  ├── develop (开发集成)
  │     ├── feature/* (功能分支)
  │     ├── fix/* (修复分支)
  │     └── hotfix/* (紧急修复)
  └── release/* (发布准备)
```

### 提交规范（Conventional Commits）

```
type(scope): subject

body

footer
```

**类型（type）**：
- `feat`: 新功能
- `fix`: 问题修复
- `docs`: 文档更新
- `test`: 测试相关
- `chore`: 构建工具或辅助工具的变动
- `refactor`: 代码重构
- `perf`: 性能优化
- `ci`: CI 配置文件和脚本的变动
- `style`: 代码格式调整

**示例**：
```
feat(registry): add BM25 search algorithm support

Implement BM25 search algorithm for better tool discovery.
Includes tokenization with jieba for Chinese text support.

Closes #1
```

---

## 质量控制检查点

### 开发阶段检查

- [ ] 使用 TodoWrite 工具实时跟踪任务状态
- [ ] 关键节点必须进行质量检查
- [ ] 每个功能完成后必须经过自我验证

### 代码质量标准

- [ ] 单元测试覆盖率 > 80%
- [ ] 所有公共方法必须有测试用例
- [ ] 边界条件和异常情况必须覆盖

### 安全与性能检查

- [ ] 提交前进行代码质量检查
- [ ] 关键功能必须经过人工审查
- [ ] 性能影响评估和基准测试

---

## 常见问题

### Q: TASK.md 和 Git 提交的关系？

A: TASK.md 是任务追踪文档，每阶段完成后必须更新并独立提交。不要批量更新多个阶段。

### Q: 如何处理分支冲突？

A:
1. 先拉取最新代码
2. 解决冲突
3. 运行测试验证
4. 提交并推送

### Q: 什么情况下可以跳过某些阶段？

A: 只有在以下情况可以跳过：
- 文档修正（无需代码实现）
- 紧急热修复（需事后补齐文档）

---

**维护者**: Maric
**最后更新**: 2026-01-04
